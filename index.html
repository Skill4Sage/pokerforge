<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PokerForge - GTO Coach</title>
    <!-- React & Babel via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #030712;
            color: white;
            overflow-x: hidden;
        }
        .action-btn { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .action-btn:active { transform: scale(0.95); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        @keyframes pulse-soft {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .animate-pulse-soft { animation: pulse-soft 3s infinite ease-in-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- ICONE SVG PERSONALIZZATE ---
        const Icons = {
            History: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
            X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>,
            Flame: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>,
            Shield: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg>,
            Swords: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><polyline points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/><line x1="13" y1="19" x2="19" y2="13"/><line x1="16" y1="16" x2="20" y2="20"/><line x1="19" y1="21" x2="20" y2="20"/><polyline points="9.5 6.5 21 18 21 21 18 21 6.5 9.5"/><line x1="5" y1="11" x2="11" y2="5"/><line x1="8" y1="8" x2="4" y2="4"/><line x1="3" y1="5" x2="4" y2="4"/></svg>,
            Zap: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.75 12 3l1 10.25h7L12 21l-1-10.25z"/></svg>,
            Layout: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>,
            Target: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
            ChevronLeft: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>,
            ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
            BookOpen: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        };

        // --- DATABASE RANGES GTO 6-MAX 100BB ---
        const OPEN_RAISE_RANGES = {
            'UTG': { pairs: ['AA','KK','QQ','JJ','TT','99','88','77'], suited: ['AK','AQ','AJ','AT','KQs','KJs','QJs','JTs'], offsuit: ['AK','AQ'] },
            'MP': { pairs: ['AA','KK','QQ','JJ','TT','99','88','77','66'], suited: ['AK','AQ','AJ','AT','A9s','A8s','KQs','KJs','KTs','QJs','QTs','JTs','T9s'], offsuit: ['AK','AQ','AJ'] },
            'CO': { pairs: ['AA','KK','QQ','JJ','TT','99','88','77','66','55','44'], suited: ['AK','AQ','AJ','AT','A9s','A8s','A7s','A6s','A5s','A4s','A3s','A2s','KQs','KJs','KTs','K9s','QJs','QTs','Q9s','JTs','J9s','T9s','98s','87s','76s'], offsuit: ['AK','AQ','AJ','AT'] },
            'BTN': { pairs: ['AA','KK','QQ','JJ','TT','99','88','77','66','55','44','33','22'], suited: ['AK','AQ','AJ','AT','A9s','A8s','A7s','A6s','A5s','A4s','A3s','A2s','KQs','KJs','KTs','K9s','K8s','K7s','K6s','K5s','K4s','K3s','K2s','QJs','QTs','Q9s','Q8s','Q7s','Q6s','Q5s','JTs','J9s','J8s','T9s','T8s','98s','97s','87s','76s','65s','54s'], offsuit: ['AK','AQ','AJ','AT','A9o','A8o','A7o','KQo','KJo','KTo','QJo','QTo','JTo'] },
            'SB': { pairs: ['AA','KK','QQ','JJ','TT','99','88','77','66','55','44','33','22'], suited: ['AK','AQ','AJ','AT','A9s','A8s','A7s','A6s','A5s','A4s','A3s','A2s','KQs','KJs','KTs','K9s','K8s','K7s','QJs','QTs','Q9s','JTs','J9s','T9s','87s','76s','65s','54s'], offsuit: ['AK','AQ','AJ','AT','A9o','A8o','KQo','KJo','KTo','QJo'] }
        };

        const VS_RAISE_DATA = {
            'MP vs UTG': { threeBet: ['AA','KK','QQ','AKs','AKo'], call: ['JJ','TT','99','88','AQs','AJs','KQs'] },
            'CO vs MP': { threeBet: ['AA','KK','QQ','JJ','AKs','AKo','A5s','A4s'], call: ['TT','99','88','77','AQs','AJs','ATs','KQs','KJs','QJs','JTs'] },
            'BTN vs CO': { threeBet: ['AA','KK','QQ','JJ','TT','AKs','AKo','AQs','A5s','A4s'], call: ['99','88','77','66','55','AJs','ATs','A9s','KQs','KJs','KTs','QJs','QTs','JTs','98s'] },
            'BB vs BTN': { threeBet: ['AA','KK','QQ','JJ','TT','AKs','AKo','AQs','A5s','A4s','A3s'], call: ['99','88','77','66','55','44','33','22','AJs','ATs','A9s','A8s','KQs','KJs','KTs','QJs','QTs','JTs','J9s','T9s','98s','87s','76s'] }
        };

        const VS_3BET_DATA = {
            'UTG vs BTN 3-B': { fourBet: ['AA','KK','QQ','AKs','AKo'], call: ['JJ','TT','99','AQs','AJs','KQs','KJs'] },
            'BTN vs SB 3-B': { fourBet: ['AA','KK','QQ','AKs','AKo','A5s','A4s'], call: ['JJ','TT','99','88','77','AQs','AJs','ATs','KQs','KJs','QJs','JTs'] },
            'SB vs BB 3-B': { fourBet: ['AA','KK','QQ','AKs','AKo','A5s','A4s'], call: ['JJ','TT','99','88','77','AQs','AJs','ATs','KQs','KJs'] }
        };

        const POST_FLOP_DRILLS = [
            { hand: ['J', 'J'], board: [['A', '‚ô•'], ['7', '‚ô¶'], ['2', '‚ô£']], scenario: "Hai aperto pre-flop. Al flop un avversario punta forte (75% pot).", correct: 'FOLD', lesson: "L'Asso a terra √® una 'Overcard' letale per i tuoi Jack. Se l'avversario aggredisce, la tua mano ha perso gran parte del valore relativo. Foldare salva il tuo stack." },
            { hand: ['A', 'K'], board: [['K', '‚ô†'], ['8', '‚ô¶'], ['3', '‚ô£']], scenario: "Hai Top Pair Top Kicker. Villain fa Check. Cosa fai?", correct: 'RAISE', lesson: "Sei quasi certamente in vantaggio. Devi puntare per estrarre valore e non regalare carte gratis ai progetti avversari." },
            { hand: ['10', '9'], board: [['J', '‚ô•'], ['Q', '‚ô¶'], ['2', '‚ô£']], scenario: "Hai progetto di scala bilaterale. Villain punta piccolo.", correct: 'CALL', lesson: "Hai 8 outs per chiudere scala. Il prezzo √® conveniente (Pot Odds) per inseguire il tuo punto." },
            { hand: ['Q', 'Q'], board: [['10', '‚ô†'], ['J', '‚ô†'], ['9', '‚ô†']], scenario: "Hai Donne ma il board mostra 3 carte di picche e scala possibile. Villain va All-in.", correct: 'FOLD', lesson: "Il board √® letale. Senza una picche in mano, chiamare qui √® un errore tecnico grave. Disciplina!" }
        ];

        const CARD_VALUES = ['A','K','Q','J','T','9','8','7','6','5','4','3','2'];
        const POSITIONS = ['UTG', 'MP', 'CO', 'BTN', 'SB', 'BB'];

        const App = () => {
            const [view, setView] = useState('start');
            const [pendingMode, setPendingMode] = useState(null);
            const [totalXP, setTotalXP] = useState(() => parseInt(localStorage.getItem('poker_xp')) || 0);
            const [history, setHistory] = useState(() => JSON.parse(localStorage.getItem('poker_history')) || []);
            const [bestStreak, setBestStreak] = useState(() => parseInt(localStorage.getItem('poker_best_streak')) || 0);
            
            const [session, setSession] = useState({ total: 30, current: 0, correct: 0, mode: 'open', type: 'random', errors: [], streak: 0, xpBonus: 1.0 });
            const [currentHand, setCurrentHand] = useState(null);
            const [timeLeft, setTimeLeft] = useState(100);
            const [feedback, setFeedback] = useState(null);
            const timerRef = useRef(null);

            const generateHand = (mode, type) => {
                let heroPos, villainPos, scenarioKey;

                if (mode === 'postflop') {
                    return { ...POST_FLOP_DRILLS[Math.floor(Math.random() * POST_FLOP_DRILLS.length)], isPostFlop: true, mode };
                }

                if (type === 'weak-spot') {
                    const modeErrors = history.flatMap(s => s.errors || []).filter(e => e.mode === mode);
                    if (modeErrors.length > 0) {
                        const err = modeErrors[Math.floor(Math.random() * modeErrors.length)];
                        heroPos = err.heroPos || 'BTN';
                        scenarioKey = err.scenarioKey;
                    }
                }

                if (!heroPos) {
                    if (mode === 'open') heroPos = POSITIONS.filter(p => p !== 'BB')[Math.floor(Math.random() * 5)];
                    else if (mode === 'defense') {
                        const keys = Object.keys(VS_RAISE_DATA);
                        scenarioKey = keys[Math.floor(Math.random() * keys.length)];
                        [heroPos, , villainPos] = scenarioKey.split(' ');
                    } else if (mode === 'vs3bet') {
                        const keys = Object.keys(VS_3BET_DATA);
                        scenarioKey = keys[Math.floor(Math.random() * keys.length)];
                        [heroPos, , villainPos] = scenarioKey.split(' ');
                    }
                }

                const isPair = Math.random() < 0.08;
                const isSuited = !isPair && Math.random() < 0.24;
                let v1 = CARD_VALUES[Math.floor(Math.random() * 12)];
                let v2 = CARD_VALUES[Math.floor(Math.random() * (13 - (CARD_VALUES.indexOf(v1) + 1))) + (CARD_VALUES.indexOf(v1) + 1)];
                if (isPair) v1 = v2 = CARD_VALUES[Math.floor(Math.random() * 13)];
                
                const handShort = v1 + v2;
                const handFull = isPair ? handShort : (handShort + (isSuited ? 's' : 'o'));
                const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
                const s1 = suits[Math.floor(Math.random()*4)];
                const s2 = isSuited ? s1 : suits[(suits.indexOf(s1)+1)%4];

                let correctAction = 'FOLD';
                if (mode === 'open') {
                    const range = OPEN_RAISE_RANGES[heroPos];
                    if ((isPair && range.pairs.includes(handShort)) || (isSuited && range.suited.some(h => h.startsWith(handShort))) || (!isSuited && range.offsuit.some(h => h.startsWith(handShort)))) correctAction = 'RAISE';
                } else if (mode === 'defense') {
                    const range = VS_RAISE_DATA[scenarioKey || 'BB vs BTN'];
                    if (range.threeBet.some(h => h === handFull || h === handShort)) correctAction = '3-BET';
                    else if (range.call.some(h => h === handFull || h === handShort)) correctAction = 'CALL';
                } else if (mode === 'vs3bet') {
                    const range = VS_3BET_DATA[scenarioKey || 'BTN vs SB 3-B'];
                    if (range.fourBet.some(h => h === handFull || h === handShort)) correctAction = '4-BET';
                    else if (range.call.some(h => h === handFull || h === handShort)) correctAction = 'CALL';
                }

                return { heroPos, villainPos, v1, v2, s1, s2, isSuited, isPair, handFull, correctAction, scenarioKey, mode };
            };

            const initSession = (numHands, type, bonusMult) => {
                const modeBaseBonus = { 'open': 1.0, 'defense': 1.2, 'vs3bet': 1.4, 'postflop': 1.5 }[pendingMode];
                const typeBonus = type === 'weak-spot' ? 1.3 : 1.0;
                setSession({ total: numHands, current: 0, correct: 0, mode: pendingMode, type: type, errors: [], streak: 0, xpBonus: modeBaseBonus * typeBonus * bonusMult });
                setCurrentHand(generateHand(pendingMode, type));
                setTimeLeft(100);
                setView('training');
            };

            const handleAction = (choice) => {
                if (feedback) return;
                clearInterval(timerRef.current);
                const normalizedChoice = (choice === 'RAISE' && currentHand.isPostFlop) ? 'RAISE' : 
                                         (choice === 'RAISE' && currentHand.mode === 'vs3bet') ? '4-BET' :
                                         (choice === 'RAISE' && currentHand.mode === 'defense') ? '3-BET' : choice;
                const isCorrect = normalizedChoice === currentHand.correct || normalizedChoice === currentHand.correctAction;
                if (isCorrect) {
                    setSession(s => ({ ...s, correct: s.correct + 1, current: s.current + 1, streak: s.streak + 1 }));
                    if (session.streak + 1 > bestStreak) {
                        setBestStreak(session.streak + 1);
                        localStorage.setItem('poker_best_streak', session.streak + 1);
                    }
                    setFeedback({ icon: "‚úÖ", title: "FORGIATO", text: currentHand.lesson || `Mossa GTO corretta con <b>${currentHand.handFull || ''}</b>.` });
                } else {
                    setSession(s => ({ ...s, current: s.current + 1, streak: 0, errors: [...s.errors, currentHand] }));
                    setFeedback({ icon: "‚ùå", title: "ERRORE", text: currentHand.lesson || `La mossa corretta era <b>${currentHand.correctAction || currentHand.correct}</b>.` });
                }
            };

            useEffect(() => {
                if (view === 'training' && !feedback) {
                    timerRef.current = setInterval(() => {
                        setTimeLeft(t => t <= 0 ? (handleAction('TIMEOUT'), 0) : t - 3.2);
                    }, 100);
                }
                return () => clearInterval(timerRef.current);
            }, [view, feedback, currentHand]);

            const Card = ({ v, s, small=false }) => (
                <div className={`${small?'w-14 h-20 p-2':'w-24 h-36 p-4'} bg-white rounded-2xl shadow-2xl flex flex-col items-center justify-between border border-gray-100 select-none transform hover:scale-105 transition-transform`}>
                    <div className={`self-start ${small?'text-sm':'text-2xl'} font-black ${s==='‚ô•'||s==='‚ô¶'?'text-red-600':'text-gray-900'}`}>{v}</div>
                    <div className={`${small?'text-3xl':'text-5xl'} ${s==='‚ô•'||s==='‚ô¶'?'text-red-600':'text-gray-900'}`}>{s}</div>
                    <div className={`self-end ${small?'text-sm':'text-2xl'} font-black rotate-180 ${s==='‚ô•'||s==='‚ô¶'?'text-red-600':'text-gray-900'}`}>{v}</div>
                </div>
            );

            const MainLogo = () => (
                <div className="relative w-52 h-52 mb-8 group select-none">
                    <div className="absolute inset-0 bg-orange-500/10 rounded-full blur-[60px] animate-pulse"></div>
                    <div className="relative z-10 w-full h-full rounded-[3.5rem] overflow-hidden flex items-center justify-center">
                        <img 
                            src="./logo.png" 
                            alt="PokerForge Logo" 
                            className="w-full h-full object-contain"
                            onError={(e) => {
                                e.target.style.display = 'none';
                                e.target.nextSibling.style.display = 'flex';
                            }}
                        />
                        <div style={{display: 'none'}} className="w-full h-full flex flex-col items-center justify-center bg-gray-900 border-4 border-gray-800 rounded-[3.5rem] text-orange-500/30 p-6">
                            <Icons.Zap />
                            <span className="text-[10px] font-black uppercase text-center mt-2 leading-tight">Configura logo.png in GitHub</span>
                        </div>
                    </div>
                </div>
            );

            if (view === 'start') {
                return (
                    <div className="fixed inset-0 bg-gray-950 flex flex-col items-center p-8 text-center justify-center overflow-y-auto select-none">
                        <MainLogo />
                        <h1 className="text-6xl font-black text-white italic uppercase tracking-tighter mb-1 leading-none">PokerForge</h1>
                        <p className="text-orange-500 font-bold text-[10px] uppercase tracking-[0.4em] mb-12 italic">Elite GTO Coaching</p>
                        <div className="w-full max-w-xs space-y-4">
                            <button onClick={() => { setPendingMode('open'); setView('select-duration'); }} className="w-full py-5 bg-gray-800 border-2 border-green-500 text-white rounded-2xl font-black flex justify-between px-8 items-center shadow-lg hover:bg-green-600 transition-all">
                                <div className='flex items-center'><Icons.Swords /> <span className="ml-3">ATTACCO</span></div>
                                <Icons.ChevronRight />
                            </button>
                            <button onClick={() => { setPendingMode('defense'); setView('select-duration'); }} className="w-full py-5 bg-gray-800 border-2 border-blue-500 text-white rounded-2xl font-black flex justify-between px-8 items-center shadow-lg hover:bg-blue-600 transition-all">
                                <div className='flex items-center'><Icons.Shield /> <span className="ml-3">DIFESA</span></div>
                                <Icons.ChevronRight />
                            </button>
                            <button onClick={() => { setPendingMode('vs3bet'); setView('select-duration'); }} className="w-full py-5 bg-gray-800 border-2 border-orange-500 text-white rounded-2xl font-black flex justify-between px-8 items-center shadow-lg hover:bg-orange-600 transition-all">
                                <div className='flex items-center'><Icons.Zap /> <span className="ml-3">VS 3-BET</span></div>
                                <Icons.ChevronRight />
                            </button>
                            <button onClick={() => { setPendingMode('postflop'); setView('select-duration'); }} className="w-full py-6 bg-gradient-to-br from-red-600 to-orange-700 text-white rounded-3xl font-black flex justify-between px-6 items-center shadow-xl transform active:scale-95 transition-transform">
                                <div className='flex flex-col items-start'><span>POST-FLOP</span><span className='text-[9px] opacity-70 italic'>Smetti di perdere chips</span></div>
                                <Icons.Layout />
                            </button>
                        </div>
                        <button onClick={() => setView('history')} className="mt-12 flex items-center text-gray-500 font-black text-[10px] uppercase tracking-widest hover:text-white transition-colors">
                            <Icons.History /> <span className="ml-2">Progressi & Analisi</span>
                        </button>
                    </div>
                );
            }

            if (view === 'select-duration') {
                const modeErrors = history.flatMap(s => s.errors || []).filter(e => e.mode === pendingMode);
                const hasErrors = modeErrors.length > 0;
                const modeTitle = pendingMode === 'vs3bet' ? 'Vs 3-Bet' : pendingMode === 'open' ? 'Attacco RFI' : pendingMode === 'defense' ? 'Difesa vs Raise' : 'Post-Flop';

                return (
                    <div className="fixed inset-0 bg-gray-950 flex flex-col select-none">
                        {/* Barra superiore corretta */}
                        <div className="w-full p-6 flex items-center border-b border-gray-800 bg-gray-900/50 backdrop-blur-md">
                            <button onClick={() => setView('start')} className="flex items-center text-gray-400 hover:text-white transition-colors py-2">
                                <Icons.ChevronLeft />
                                <span className="text-xs font-black uppercase tracking-widest ml-1">Indietro</span>
                            </button>
                        </div>

                        <div className="flex-grow flex flex-col items-center justify-center p-8 overflow-y-auto">
                            <h2 className="text-4xl font-black text-white italic uppercase mb-1 tracking-tighter text-center">{modeTitle}</h2>
                            <p className="text-orange-500 text-[10px] mb-12 uppercase tracking-[0.3em] font-black italic">Configura Sessione</p>
                            <div className="w-full max-w-xs space-y-10">
                                <div>
                                    <p className="text-[10px] font-black text-gray-500 uppercase tracking-[0.3em] mb-4 text-center">Allenamento Casuale</p>
                                    <div className="grid grid-cols-1 gap-3">
                                        {[30, 50, 100].map(n => (
                                            <button key={n} onClick={() => initSession(n, 'random', n === 30 ? 1 : n === 50 ? 1.2 : 1.5)} className="py-4 bg-gray-800 text-white rounded-2xl font-bold flex justify-between px-8 items-center border border-gray-700 hover:border-blue-500 transition-all active:scale-95">
                                                <span>{n} Mani</span><span className='text-[10px] text-blue-400 font-mono font-black italic'>x{n === 30 ? '1.0' : n === 50 ? '1.2' : '1.5'}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <p className="text-[10px] font-black text-orange-500 uppercase tracking-[0.3em] mb-4 text-center flex items-center justify-center italic">
                                        <Icons.Target /> <span className="ml-2">Focus Punti Deboli</span>
                                    </p>
                                    <div className="grid grid-cols-1 gap-3">
                                        {[30, 50].map(n => (
                                            <button key={n} disabled={!hasErrors} onClick={() => initSession(n, 'weak-spot', (n === 30 ? 1 : 1.2) * 1.3)} className={`py-4 bg-gray-800 text-orange-400 rounded-2xl font-bold flex justify-between px-8 items-center border border-orange-500/30 ${!hasErrors?'opacity-30':'hover:bg-orange-500 hover:text-white transition-all shadow-lg'}`}>
                                                <span>Focus ({n})</span><span className='text-[10px] font-mono font-black italic'>x{(n === 30 ? 1.3 : 1.56).toFixed(1)}</span>
                                            </button>
                                        ))}
                                        {!hasErrors && <p className="text-[9px] text-gray-600 mt-2 italic uppercase tracking-widest font-black text-center leading-tight">Nessuna impurit√† rilevata qui</p>}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'training' && currentHand) {
                return (
                    <div className="w-full min-h-screen bg-gray-100 flex flex-col items-center select-none">
                        <div className="w-full max-w-md bg-white border-b-2 p-5 flex justify-between items-center sticky top-0 z-50">
                            <div className='flex flex-col'>
                                <span className="text-[10px] text-blue-600 font-black uppercase tracking-widest italic leading-none mb-1">{session.type === 'weak-spot' ? 'üî• Focus' : session.mode} Mode</span>
                                <span className="text-gray-800 font-black text-sm font-mono leading-none">{session.current + 1} / {session.total}</span>
                            </div>
                            <div className='flex items-center text-orange-500 font-black text-lg'><Icons.Flame /> <span className="ml-1">{session.streak}</span></div>
                        </div>
                        <div className="w-full max-w-md h-2 bg-gray-200"><div className="h-full bg-orange-500 transition-all duration-100" style={{ width: `${timeLeft}%` }}></div></div>
                        <main className="w-full max-w-md p-6 flex flex-col items-center space-y-8 flex-grow overflow-y-auto">
                            <div className="px-6 py-2 bg-gray-900 text-white rounded-full text-[10px] font-black uppercase tracking-[0.3em] shadow-lg">
                                {currentHand.isPostFlop ? 'Analisi del Board' : session.mode==='open' ? `Posizione: ${currentHand.heroPos}` : session.mode==='vs3bet' ? `${currentHand.heroPos} apre ‚Üí ${currentHand.villainPos} 3-Bet` : `${currentHand.villainPos} apre ‚Üí Tu: ${currentHand.heroPos}`}
                            </div>
                            {currentHand.isPostFlop && (
                                <div className="flex flex-col items-center space-y-6 w-full py-4 animate-in fade-in zoom-in duration-300">
                                    <div className="flex justify-center space-x-3">{currentHand.board.map((c, i) => <Card key={i} v={c[0]} s={c[1]} small />)}</div>
                                    <div className="bg-white p-5 rounded-[2rem] border-2 border-dashed border-gray-200 text-sm font-bold text-gray-600 text-center italic leading-snug shadow-sm">"{currentHand.scenario}"</div>
                                </div>
                            )}
                            <div className="w-full bg-emerald-900 rounded-[4rem] p-12 shadow-2xl flex flex-col items-center border-8 border-emerald-800/50">
                                <div className="flex space-x-6 scale-110">
                                    <Card v={currentHand.v1 || currentHand.hand[0]} s={currentHand.s1 || "‚ô†"} />
                                    <Card v={currentHand.v2 || currentHand.hand[1]} s={currentHand.s2 || "‚ô¶"} />
                                </div>
                            </div>
                            <div className="grid grid-cols-3 gap-3 w-full px-2 mt-auto">
                                <button onClick={() => handleAction('RAISE')} className="py-5 bg-orange-600 text-white rounded-2xl font-black shadow-xl uppercase italic tracking-tighter text-lg border-b-4 border-orange-800">{session.mode==='vs3bet'?'4-Bet':'Raise'}</button>
                                <button onClick={() => handleAction('CALL')} className="py-5 bg-blue-600 text-white rounded-2xl font-black shadow-xl uppercase italic tracking-tighter text-lg border-b-4 border-blue-800">Call</button>
                                <button onClick={() => handleAction('FOLD')} className="py-5 bg-white text-red-600 rounded-2xl font-black shadow-xl uppercase italic tracking-tighter text-lg border-2 border-red-600">Fold</button>
                            </div>
                        </main>
                        {feedback && (
                            <div className="fixed inset-0 bg-black/80 flex items-end justify-center z-[100] p-4 backdrop-blur-md">
                                <div className="bg-white w-full max-w-md rounded-t-[3rem] p-10 shadow-2xl">
                                    <div className="text-7xl mb-6 text-center">{feedback.icon}</div>
                                    <h3 className="text-3xl font-black mb-4 italic uppercase tracking-tighter text-center">{feedback.title}</h3>
                                    <div className="bg-blue-50 p-6 rounded-3xl mb-10 border border-blue-100 italic leading-relaxed">
                                        <p className="text-gray-700 text-sm" dangerouslySetInnerHTML={{ __html: feedback.text }}></p>
                                    </div>
                                    <button onClick={() => { setFeedback(null); if(session.current >= session.total) finishSession(); else setCurrentHand(generateHand(session.mode, session.type)); setTimeLeft(100); }} className="w-full py-6 bg-gray-900 text-white rounded-3xl font-black text-xl italic uppercase tracking-widest active:scale-95 transition-transform shadow-xl">Prossima</button>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            const finishSession = () => {
                const acc = Math.round((session.correct / session.total) * 100);
                const xpGained = Math.round(session.correct * 25 * session.xpBonus);
                setTotalXP(prev => prev + xpGained);
                localStorage.setItem('poker_xp', totalXP + xpGained);
                const sessionData = { date: new Date().toISOString(), hands: session.total, score: session.correct, acc, mode: session.mode, errors: session.errors };
                const newHistory = [...history, sessionData].slice(-50);
                setHistory(newHistory);
                localStorage.setItem('poker_history', JSON.stringify(newHistory));
                setView('summary');
            };

            if (view === 'summary') {
                const acc = Math.round((session.correct / session.total) * 100);
                return (
                    <div className="fixed inset-0 bg-white flex flex-col p-10 items-center justify-center text-center overflow-y-auto select-none text-gray-900">
                        <h2 className="text-5xl font-black mb-2 italic uppercase tracking-tighter">Forgiatura Finita</h2>
                        <p className="text-xl text-blue-600 font-bold mb-16 tracking-tight font-mono uppercase italic">Precisione Finale: {acc}%</p>
                        <div className="w-full max-w-xs bg-gray-50 p-10 rounded-[4rem] border border-gray-100 mb-12 shadow-inner">
                           <p className="text-[10px] font-black text-gray-400 uppercase tracking-[0.3em] mb-3 italic">Esperienza Guadagnata</p>
                           <div className="text-5xl font-black text-gray-800 font-mono tracking-tighter">+{Math.round(session.correct * 25 * session.xpBonus)} XP</div>
                        </div>
                        <button onClick={() => setView('start')} className="w-full max-w-xs py-6 bg-gray-900 text-white rounded-3xl font-black text-lg shadow-xl uppercase italic tracking-widest active:scale-95 transition-transform">Menu Principale</button>
                    </div>
                );
            }

            if (view === 'history') {
                return (
                    <div className="fixed inset-0 bg-gray-50 flex flex-col select-none text-gray-900">
                        <div className='w-full p-6 flex justify-between items-center border-b border-gray-200 bg-white sticky top-0'>
                            <h2 className="text-2xl font-black italic tracking-tighter uppercase leading-none">Archivio</h2>
                            <button onClick={() => setView('start')} className='p-3 bg-gray-100 rounded-full text-gray-400 hover:text-gray-900 transition-colors'><Icons.X /></button>
                        </div>
                        <div className="flex-grow overflow-y-auto p-6 space-y-4">
                            {history.slice().reverse().map((s, i) => (
                                <div key={i} className="bg-white p-7 rounded-[2rem] flex justify-between items-center shadow-sm border border-gray-100">
                                    <div className='text-left'>
                                        <p className='text-[10px] font-black text-gray-300 uppercase tracking-[0.2em] font-mono'>{new Date(s.date).toLocaleDateString()}</p>
                                        <p className='font-black text-gray-800 italic uppercase leading-none mt-2 text-[10px]'>{s.mode} - {s.hands} Mani</p>
                                    </div>
                                    <div className='text-right'><p className='text-blue-600 font-black text-3xl italic font-mono leading-none'>{s.acc}%</p></div>
                                </div>
                            ))}
                            {history.length === 0 && <p className="text-gray-400 italic text-center py-20 text-sm uppercase font-black tracking-widest opacity-30">Nessuna sessione registrata</p>}
                        </div>
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

