<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Poker GTO Coach - PWA</title>
    <!-- Tailwind CSS per un design moderno -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .poker-card {
            aspect-ratio: 2/3;
            perspective: 1000px;
        }
        .timer-glow {
            box-shadow: 0 0 15px rgba(28, 176, 246, 0.4);
        }
        .action-btn {
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .action-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center select-none overflow-x-hidden">

    <!-- Header / Gamification -->
    <div class="w-full max-w-md bg-white border-b-2 border-gray-200 p-4 sticky top-0 z-50 flex justify-between items-center">
        <div class="flex items-center space-x-2">
            <span class="text-orange-500 text-xl font-bold">üî• <span id="streak">0</span></span>
        </div>
        <div class="flex-grow mx-4">
            <div class="h-3 w-full bg-gray-200 rounded-full overflow-hidden">
                <div id="xp-progress" class="h-full bg-green-500 transition-all duration-500" style="width: 0%"></div>
            </div>
        </div>
        <div class="flex items-center space-x-2">
            <span class="text-blue-500 font-bold">‚≠ê <span id="xp">0</span></span>
        </div>
    </div>

    <!-- Timer Bar -->
    <div class="w-full max-w-md h-1 bg-gray-200">
        <div id="timer-bar" class="h-full bg-blue-400 w-full"></div>
    </div>

    <!-- Main Content -->
    <main class="w-full max-w-md p-4 flex flex-col items-center space-y-6 flex-grow">
        
        <div id="position-badge" class="px-4 py-1 bg-gray-800 text-white rounded-full text-xs font-bold tracking-widest uppercase">
            Posizione: --
        </div>

        <h2 class="text-xl font-bold text-gray-700 text-center">
            Tutti foldano fino a te. <br>Qual √® la mossa GTO?
        </h2>

        <!-- Table / Cards Area -->
        <div class="w-full bg-emerald-800 rounded-3xl p-8 shadow-inner flex flex-col items-center relative overflow-hidden">
            <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(#fff 1px, transparent 1px); background-size: 20px 20px;"></div>
            
            <div id="cards-container" class="flex space-x-4 relative z-10">
                <!-- Cards injected by JS -->
            </div>

            <div id="equity-badge" class="mt-6 text-emerald-100 text-sm font-medium opacity-80">
                Equity stimata: --
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="grid grid-cols-2 gap-4 w-full">
            <button onclick="handleAction('RAISE')" class="action-btn py-4 bg-white border-b-4 border-green-600 rounded-2xl text-green-600 font-bold text-lg hover:bg-green-50 active:border-b-0 active:translate-y-1">RAISE</button>
            <button onclick="handleAction('FOLD')" class="action-btn py-4 bg-white border-b-4 border-red-600 rounded-2xl text-red-600 font-bold text-lg hover:bg-red-50 active:border-b-0 active:translate-y-1">FOLD</button>
        </div>

    </main>

    <!-- Feedback Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black/50 hidden items-end justify-center z-[100] p-4">
        <div class="bg-white w-full max-w-md rounded-t-3xl p-6 transform translate-y-0 transition-transform">
            <div id="result-icon" class="text-4xl mb-2">‚úÖ</div>
            <h3 id="result-title" class="text-2xl font-bold mb-2">Eccellente!</h3>
            <p id="result-text" class="text-gray-600 mb-6 leading-relaxed"></p>
            <button onclick="resetRound()" class="w-full py-4 bg-blue-500 text-white rounded-2xl font-bold text-xl shadow-lg shadow-blue-200">CONTINUA</button>
        </div>
    </div>

    <script>
        // CONFIGURAZIONE RANGE (Basata su tabelle GTO standard 6-Max)
        // Definiamo cosa viene APERTO (Raise). Tutto il resto √® Fold.
        const GTO_RANGES = {
            'UTG': {
                perc: 15,
                pairs: ['AA','KK','QQ','JJ','1010','99','88','77'],
                suitedAces: ['AK','AQ','AJ','A10'],
                offsuitAces: ['AK','AQ'],
                suitedBroad: ['KQ','KJ','QJ'],
                suitedConn: ['J10','109']
            },
            'MP': {
                perc: 18,
                pairs: ['AA','KK','QQ','JJ','1010','99','88','77','66'],
                suitedAces: ['AK','AQ','AJ','A10','A9','A8'],
                offsuitAces: ['AK','AQ','AJ'],
                suitedBroad: ['KQ','KJ','QJ','KT','QT','JT'],
                suitedConn: ['J10','109','98']
            },
            'CO': {
                perc: 26,
                pairs: ['AA','KK','QQ','JJ','1010','99','88','77','66','55','44'],
                suitedAces: ['AK','AQ','AJ','A10','A9','A8','A7','A6','A5','A4','A3','A2'],
                offsuitAces: ['AK','AQ','AJ','A10'],
                suitedBroad: ['KQ','KJ','QJ','KT','QT','JT','K9','Q9','J9','T9'],
                suitedConn: ['J10','109','98','87','76']
            },
            'BTN': {
                perc: 48,
                pairs: ['AA','KK','QQ','JJ','1010','99','88','77','66','55','44','33','22'],
                suitedAces: ['AK','AQ','AJ','A10','A9','A8','A7','A6','A5','A4','A3','A2'],
                offsuitAces: ['AK','AQ','AJ','A10','A9','A8','A7'],
                suitedBroad: ['KQ','KJ','QJ','KT','QT','JT','K9','Q9','J9','T9','K8','K7','K6','K5','K4','K3','K2'],
                suitedConn: ['J10','109','98','87','76','65','54','J8','T8','97']
            },
            'SB': {
                perc: 42,
                pairs: ['AA','KK','QQ','JJ','1010','99','88','77','66','55','44','33','22'],
                suitedAces: ['AK','AQ','AJ','A10','A9','A8','A7','A6','A5','A4','A3','A2'],
                offsuitAces: ['AK','AQ','AJ','A10','A9','A8'],
                suitedBroad: ['KQ','KJ','QJ','KT','QT','JT','K9','Q9','J9','T9','K8','K7'],
                suitedConn: ['J10','109','98','87','76','65','54']
            }
        };

        const CARD_VALUES = ['A','K','Q','J','10','9','8','7','6','5','4','3','2'];
        const POSITIONS = ['UTG', 'MP', 'CO', 'BTN', 'SB'];

        let state = {
            xp: parseInt(localStorage.getItem('poker_xp')) || 0,
            streak: parseInt(localStorage.getItem('poker_streak')) || 0,
            currentHand: null,
            timer: null,
            timeLeft: 100
        };

        function getEquity(v1, v2, suited) {
            // Valori approssimativi di equity pre-flop vs range medio
            if(v1 === v2) return (80 - CARD_VALUES.indexOf(v1) * 2) + "%";
            let base = 50 - (CARD_VALUES.indexOf(v1) + CARD_VALUES.indexOf(v2));
            if(suited) base += 4;
            return Math.max(15, Math.min(68, base)) + "%";
        }

        function generateHand() {
            const pos = POSITIONS[Math.floor(Math.random() * POSITIONS.length)];
            
            // Frequenza realistica: 1/17 sono coppie, resto distribuito
            const isPair = Math.random() < 0.06;
            const isSuited = Math.random() < 0.24; // ~1/4 delle mani non coppie sono suited

            let v1, v2;
            if (isPair) {
                v1 = v2 = CARD_VALUES[Math.floor(Math.random() * CARD_VALUES.length)];
            } else {
                v1 = CARD_VALUES[Math.floor(Math.random() * (CARD_VALUES.length - 1))];
                v2 = CARD_VALUES[Math.floor(Math.random() * (CARD_VALUES.indexOf(v1) + 1) + (CARD_VALUES.indexOf(v1) + 1))];
                if (!v2) v2 = CARD_VALUES[CARD_VALUES.length - 1];
            }

            const handStr = v1 + v2;
            const range = GTO_RANGES[pos];
            let shouldRaise = false;

            if (isPair) {
                if (range.pairs.includes(handStr)) shouldRaise = true;
            } else if (isSuited) {
                if (v1 === 'A' && range.suitedAces.includes(handStr)) shouldRaise = true;
                else if (range.suitedBroad && range.suitedBroad.includes(handStr)) shouldRaise = true;
                else if (range.suitedConn && range.suitedConn.includes(handStr)) shouldRaise = true;
            } else {
                if (v1 === 'A' && range.offsuitAces.includes(handStr)) shouldRaise = true;
                else if (range.offsuitBroad && range.offsuitBroad.includes(handStr)) shouldRaise = true;
            }

            return {
                pos, v1, v2, isSuited, isPair,
                correctAction: shouldRaise ? 'RAISE' : 'FOLD',
                equity: getEquity(v1, v2, isSuited)
            };
        }

        function renderCards() {
            const container = document.getElementById('cards-container');
            container.innerHTML = '';
            
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const suit1 = suits[Math.floor(Math.random()*4)];
            const suit2 = state.currentHand.isSuited ? suit1 : suits[(suits.indexOf(suit1)+1)%4];

            [ {v: state.currentHand.v1, s: suit1}, {v: state.currentHand.v1 === state.currentHand.v2 ? state.currentHand.v1 : state.currentHand.v2, s: suit2} ].forEach(c => {
                const color = (c.s === '‚ô•' || c.s === '‚ô¶') ? 'text-red-500' : 'text-gray-900';
                container.innerHTML += `
                    <div class="w-20 h-32 bg-white rounded-xl shadow-xl flex flex-col items-center justify-between p-2">
                        <div class="self-start text-lg font-bold ${color}">${c.v}</div>
                        <div class="text-3xl ${color}">${c.s}</div>
                        <div class="self-end text-lg font-bold rotate-180 ${color}">${c.v}</div>
                    </div>
                `;
            });
        }

        function startTimer() {
            state.timeLeft = 100;
            const bar = document.getElementById('timer-bar');
            clearInterval(state.timer);
            state.timer = setInterval(() => {
                state.timeLeft -= 1.5; // Circa 7 secondi
                bar.style.width = state.timeLeft + '%';
                if(state.timeLeft <= 0) {
                    clearInterval(state.timer);
                    handleAction('TIMEOUT');
                }
            }, 100);
        }

        function handleAction(choice) {
            clearInterval(state.timer);
            const hand = state.currentHand;
            const range = GTO_RANGES[hand.pos];
            const isCorrect = choice === hand.correctAction;

            const overlay = document.getElementById('overlay');
            const title = document.getElementById('result-title');
            const text = document.getElementById('result-text');
            const icon = document.getElementById('result-icon');

            if (isCorrect) {
                state.xp += 10;
                state.streak++;
                title.innerText = "Ottimo!";
                icon.innerText = "‚úÖ";
                text.innerHTML = `Da <b>${hand.pos}</b> apriamo circa il <b>${range.perc}%</b> delle mani migliori. <br><br>Questa mano (${hand.v1}${hand.v2}${hand.isSuited ? 's' : hand.isPair ? '' : 'o'}) fa parte della nostra strategia di apertura.`;
            } else {
                state.streak = 0;
                title.innerText = choice === 'TIMEOUT' ? "Tempo Scaduto!" : "Mossa Errata";
                icon.innerText = "‚ùå";
                const mossaC = hand.correctAction === 'RAISE' ? 'Rilanciare' : 'Passare (Fold)';
                const motivo = hand.correctAction === 'RAISE' 
                    ? `Da <b>${hand.pos}</b> giochiamo abbastanza larghi (${range.perc}%) e questa mano √® abbastanza forte per aprire.`
                    : `Da <b>${hand.pos}</b> giochiamo chiusi (apriamo solo il ${range.perc}%). Questa mano √® troppo debole per aprire da qui.`;
                text.innerHTML = `La mossa GTO era <b>${mossaC}</b>. <br><br>${motivo}`;
            }

            saveState();
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
        }

        function saveState() {
            localStorage.setItem('poker_xp', state.xp);
            localStorage.setItem('poker_streak', state.streak);
            document.getElementById('xp').innerText = state.xp;
            document.getElementById('streak').innerText = state.streak;
            document.getElementById('xp-progress').style.width = (state.xp % 100) + '%';
        }

        function resetRound() {
            document.getElementById('overlay').classList.add('hidden');
            document.getElementById('overlay').classList.remove('flex');
            state.currentHand = generateHand();
            document.getElementById('position-badge').innerText = `Posizione: ${state.currentHand.pos}`;
            document.getElementById('equity-badge').innerText = `Equity stimata: ${state.currentHand.equity}`;
            renderCards();
            startTimer();
        }

        // Inizializzazione
        saveState();
        resetRound();
    </script>
</body>
</html>
